<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AWS CPC Learning Modules | Integrity Programming</title>
  <link rel="stylesheet" href="../css/swag.css" />
</head>

<body>
  <main class="container">
    <!-- Back Button -->
    <button onclick="window.location.href='index.html'" class="secondary-btn mb-3">üè† Back to CPC Menu</button>

    <!-- ===================================================== -->
    <!-- DOMAIN FILTER -->
    <!-- ===================================================== -->
    <div id="domain-filter" class="domain-filter">
  <p class="filter-title"><strong>Filter by Domain (optional):</strong></p>
  <div class="filter-options">
    <label><input type="checkbox" class="domain-check" value="Cloud Concepts"> Cloud Concepts</label>
    <label><input type="checkbox" class="domain-check" value="Security & Compliance"> Security & Compliance</label>
    <label><input type="checkbox" class="domain-check" value="Technology"> Technology</label>
    <label><input type="checkbox" class="domain-check" value="Billing & Pricing"> Billing & Pricing</label>
    <label><input type="checkbox" class="domain-check" value="Networking & Content Delivery"> Networking & Content Delivery</label>
  </div>
  <!-- Clear Filters Button -->
<div class="mt-3">
  <button id="clear-filters-btn" class="warning-btn">üßπ Clear Filters</button>
</div>

</div>



    <!-- ===================================================== -->
    <!-- LEARNING MODULES SCREEN -->
    <!-- ===================================================== -->
    <section id="modules-screen" class="card active">
      <h1 class="fw-bold">üìò AWS Bite-Size Learning</h1>
      <p class="lead">Short, focused lessons to help you master Cloud Practitioner concepts.</p>

      <div id="module-content" class="mt-3"></div>

      <!-- Reader Buttons -->
      <div class="btn-group mt-3">
        <button class="green-btn" id="read-btn">üîä Read Aloud</button>
        <button class="warning-btn" id="stop-btn">‚èπÔ∏è Stop</button>
      </div>

      <!-- Navigation -->
      <div class="btn-group mt-4">
        <button id="prev-module" class="secondary-btn">‚¨ÖÔ∏è Previous</button>
        <button id="next-module" class="blue-btn">Next ‚û°Ô∏è</button>
      </div>

      <!-- Other Actions -->
      <div class="btn-group mt-4">
        <button onclick="window.location.href='quiz.html'" class="green-btn">üß† Take Practice Quiz</button>
        <button onclick="window.location.href='../index.html'" class="warning-btn">üèÅ Exit to Main Hub</button>
      </div>
    </section>
  </main>

  <!-- ===================================================== -->
  <!-- SCRIPTS -->
  <!-- ===================================================== -->
  <script src="js/modules.js"></script>

  <script>
    let preferredVoice = null;
    let isSpeaking = false;
    let filteredModules = [...awsModules];
    let currentModule = 0;

    // =====================================================
    // üí¨ Filter Logic
    // =====================================================
    function applyDomainFilter() {
      const checked = Array.from(document.querySelectorAll(".domain-check:checked")).map(cb => cb.value);

      filteredModules = checked.length
        ? awsModules.filter(m => checked.includes(m.domain))
        : [...awsModules];

      currentModule = 0;
      showModule(currentModule);
    }

    document.querySelectorAll(".domain-check").forEach(cb => {
      cb.addEventListener("change", applyDomainFilter);
    });

    // =====================================================
    // üéôÔ∏è Voice Setup (Female Voice Preference)
    // =====================================================
    function loadVoices() {
      const voices = window.speechSynthesis.getVoices();
      if (!voices.length) {
        window.speechSynthesis.onvoiceschanged = loadVoices;
        return;
      }

      const femaleCandidates = voices.filter(v =>
        /female|Google US English|Microsoft Aria|Jenny|Samantha|en-US/i.test(v.name)
      );
      preferredVoice = femaleCandidates[0] || voices.find(v => /en/i.test(v.lang)) || voices[0];
    }
    loadVoices();

    function readCurrentModule() {
      const module = filteredModules[currentModule];
      if (!module || !window.speechSynthesis) return;

      window.speechSynthesis.cancel();
      const textToSpeak = `${module.title}. ${module.text.replace(/(<([^>]+)>)/gi, "")}`;
      const utterance = new SpeechSynthesisUtterance(textToSpeak);
      utterance.lang = preferredVoice?.lang || "en-US";
      utterance.rate = 1.0;
      utterance.pitch = 1.05;
      if (preferredVoice) utterance.voice = preferredVoice;

      window.speechSynthesis.speak(utterance);
      isSpeaking = true;
    }

    function stopReading() {
      window.speechSynthesis.cancel();
      isSpeaking = false;
    }

    // =====================================================
    // üß≠ Navigation
    // =====================================================
    function showModule(index) {
      if (index < 0 || index >= filteredModules.length) return;
      const module = filteredModules[index];
      const contentDiv = document.getElementById("module-content");
      contentDiv.innerHTML = `
        <h3>${module.title}</h3>
        <p><strong>Domain:</strong> ${module.domain}</p>
        <p>${module.text}</p>
        <p><em>Duration: ${module.duration}</em></p>
        <p class="mt-2"><small>Lesson ${index + 1} of ${filteredModules.length}</small></p>
      `;
      window.scrollTo({ top: 0, behavior: "smooth" });
      if (isSpeaking) readCurrentModule();
    }

    document.getElementById("next-module").addEventListener("click", () => {
      if (currentModule < filteredModules.length - 1) {
        currentModule++;
        showModule(currentModule);
      }
    });

    document.getElementById("prev-module").addEventListener("click", () => {
      if (currentModule > 0) {
        currentModule--;
        showModule(currentModule);
      }
    });

    document.getElementById("read-btn").addEventListener("click", readCurrentModule);
    document.getElementById("stop-btn").addEventListener("click", stopReading);

    // Initialize first lesson
    showModule(currentModule);
  </script>
</body>
</html>
